<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë™ ìë™ í•„í„° ì‹œìŠ¤í…œ</title>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=c4efd9618689d77a19905c8996d3fe3f&libraries=services"></script>
<style>
    :root { --primary: #00d2ff; --sub: #007bff; --bg: #f4f7f6; }
    body { font-family: 'Pretendard', sans-serif; padding: 0; margin: 0; background: var(--bg); color: #333; }
    .header-nav { background: #fff; padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #ddd; position: sticky; top:0; z-index:100; }
    .header-nav a { text-decoration: none; color: var(--sub); font-weight: bold; border: 1px solid var(--sub); padding: 4px 10px; border-radius: 5px; }
    .main-container { padding: 15px; }
    .tabs { display: flex; margin-bottom: 15px; background: #eee; border-radius: 10px; padding: 5px; }
    .tab-button { flex: 1; padding: 12px; border: none; background: none; cursor: pointer; border-radius: 8px; font-weight: bold; color: #666; }
    .tab-button.active { background: white; color: var(--sub); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .mapWrap { position: relative; border-radius: 15px; overflow: hidden; border: 1px solid #ddd; margin-bottom: 15px; height: 350px; background: #eee; }
    #map { width: 100%; height: 100%; }
    textarea { width: 100%; height: 120px; border-radius: 10px; border: 1px solid #ddd; padding: 10px; box-sizing: border-box; }
    select, .main-btn { width: 100%; padding: 15px; margin-top: 10px; border-radius: 10px; border: 1px solid #ddd; font-size: 1rem; }
    .main-btn { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
    .copy-btn { background: #6c757d; margin-top: 5px; }
    .box { border: 1px solid #ddd; padding: 15px; margin-top: 10px; border-radius: 12px; background: white; min-height: 50px; }
    .group-container { background: white; border: 1px solid #eee; border-radius: 12px; padding: 10px; margin-bottom: 15px; }
    .groupHeader { display: flex; align-items: center; gap: 8px; padding-bottom: 8px; border-bottom: 1px solid #f0f0f0; margin-bottom: 10px; font-weight: bold; color: var(--sub); }
    .row { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; padding: 5px; }
    .row input[type=number] { width: 80px; padding: 5px; border: 1px solid #ddd; border-radius: 5px; }
</style>
</head>
<body>
<div class="header-nav"><a href="index.html">ğŸ  í¬í„¸ë¡œ</a><span style="margin-left:15px; font-weight:bold;">ë™ ìë™ í•„í„° ì‹œìŠ¤í…œ</span></div>
<div class="main-container">
    <div class="tabs">
        <button class="tab-button active" onclick="tab(event,'search')">ê²€ìƒ‰</button>
        <button class="tab-button" onclick="tab(event,'accept')">ìˆ˜ë½</button>
    </div>
    <div id="search" class="tab-content">
        <div class="mapWrap"><div id="map"></div></div>
        <select id="radius"><option value="5">5km ì´ë‚´</option><option value="10">10km ì´ë‚´</option></select>
        <button class="main-btn" onclick="findDongs()">ë™ ê²€ìƒ‰í•˜ê¸°</button>
        <div id="searchResult"></div>
    </div>
    <div id="accept" class="tab-content" style="display:none;">
        <textarea id="acceptText" placeholder="ì£¼ì†Œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        <button class="main-btn" onclick="extractAccept()">ë™ ì´ë¦„ ì¶”ì¶œ</button>
        <div id="acceptList" style="margin-top:15px;"></div>
        <button class="main-btn" style="background:var(--sub);" onclick="makeFinal()">ìµœì¢… ê²°ê³¼ ìƒì„± (#)</button>
        <div id="finalBox" class="box"></div>
    </div>
</div>

<script>
let map, ps, myPos;
function initMap() {
    navigator.geolocation.getCurrentPosition(pos => {
        myPos = new kakao.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
        map = new kakao.maps.Map(document.getElementById('map'), { center: myPos, level: 7 });
        ps = new kakao.maps.services.Places();
    }, () => {
        myPos = new kakao.maps.LatLng(35.247, 128.651);
        map = new kakao.maps.Map(document.getElementById('map'), { center: myPos, level: 7 });
        ps = new kakao.maps.services.Places();
    });
}
kakao.maps.load(initMap);

function tab(evt, id){
    document.querySelectorAll(".tab-content").forEach(v=>v.style.display="none");
    document.getElementById(id).style.display="block";
    document.querySelectorAll(".tab-button").forEach(b=>b.classList.remove("active"));
    evt.target.classList.add("active");
}

function extractAccept(){
    const text = document.getElementById("acceptText").value;
    const lines = text.split(/[,\n]/).map(v=>v.trim()).filter(v=>v);
    const groups = {};
    lines.forEach(line => {
        const parts = line.split(" ");
        const groupName = parts.slice(0, 3).join(" "); // ì‹œ/êµ°/êµ¬
        const dong = parts[3] ? parts[3].replace(/[0-9]/g, "") : parts[2];
        if(!groups[groupName]) groups[groupName] = [];
        if(!groups[groupName].includes(dong)) groups[groupName].push(dong);
    });
    renderGroups(groups);
}

function renderGroups(groups) {
    const list = document.getElementById("acceptList");
    list.innerHTML = "";
    Object.keys(groups).forEach((g, idx) => {
        let html = `<div class="group-container" id="g-${idx}">
            <div class="groupHeader">
                <input type="checkbox" onchange="toggleGroup(this, 'g-${idx}')"> <span>${g}</span>
            </div>`;
        groups[g].forEach(d => {
            html += `<div class="row">
                <input type="checkbox" class="dong-check"> <span>${d}</span>
                <input type="number" placeholder="ê¸ˆì•¡" class="dong-price">
            </div>`;
        });
        html += `</div>`;
        list.innerHTML += html;
    });
}

function toggleGroup(chk, groupId) {
    const container = document.getElementById(groupId);
    const checks = container.querySelectorAll(".dong-check");
    checks.forEach(c => c.checked = chk.checked);
}

function makeFinal(){
    const rows = document.querySelectorAll(".row");
    let res = [];
    rows.forEach(r => {
        if(r.querySelector(".dong-check").checked){
            const name = r.querySelector("span").innerText;
            const price = r.querySelector(".dong-price").value;
            if(price) res.push(`${name}#${price}`);
        }
    });
    document.getElementById("finalBox").innerText = res.join(",");
}
</script>
</body>
</html>
