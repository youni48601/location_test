<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìŠ¤ë§ˆíŠ¸ êµí†µ í—ˆë¸Œ</title>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=c4efd9618689d77a19905c8996d3fe3f&libraries=services"></script>
<style>
    :root { --primary: #00d2ff; --sub: #007bff; --accent: #ff9f43; }
    body { font-family: 'Pretendard', sans-serif; padding: 0; margin: 0; background: #f4f7f6; color: #333; }
    .header-nav { background: #fff; padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #ddd; position: sticky; top:0; z-index:100; }
    .header-nav a { text-decoration: none; color: var(--sub); font-weight: bold; border: 1px solid var(--sub); padding: 4px 10px; border-radius: 5px; }
    
    /* ì§€ë„ í¬ê¸° ëª…ì‹œì  ì§€ì • (í•„ìˆ˜) */
    #map { width: 100%; height: 350px; background: #eee; border-bottom: 2px solid var(--primary); display: block; }
    
    .controls { padding: 20px; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    select, .search-btn { width: 100%; padding: 15px; border-radius: 10px; border: 1px solid #ddd; font-size: 1rem; }
    .search-btn { background: var(--primary); color: white; border: none; font-weight: bold; margin-top: 10px; cursor: pointer; }
    
    #resultList { padding: 10px; }
    .result-card { background: white; padding: 18px; border-radius: 15px; margin-bottom: 12px; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
    .result-card h4 { margin: 0 0 5px 0; color: #222; }
    .result-card p { margin: 0; font-size: 0.85rem; color: #777; }
    
    .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px; }
    .action-btn { text-align: center; padding: 10px; border-radius: 8px; font-size: 0.85rem; font-weight: bold; text-decoration: none; border: 1px solid #ddd; }
    .btn-sch { background: #fff4e6; color: #d35400; border-color: #ffd8a8; }
    .btn-res { background: #eafaf1; color: #27ae60; border-color: #abebc6; }
</style>
</head>
<body>
<div class="header-nav"><a href="index.html">ğŸ  í¬í„¸ë¡œ</a><span style="margin-left:15px; font-weight:bold;">ìŠ¤ë§ˆíŠ¸ êµí†µ í—ˆë¸Œ</span></div>

<div id="map"></div>

<div class="controls">
    <select id="radius">
        <option value="5000">5km ì´ë‚´</option>
        <option value="10000" selected>10km ì´ë‚´</option>
        <option value="20000">20km ì´ë‚´</option>
    </select>
    <button class="search-btn" onclick="searchHubs()">ì£¼ë³€ ì—­/í„°ë¯¸ë„ ê²€ìƒ‰í•˜ê¸°</button>
</div>

<div id="resultList"></div>

<script>
let map, ps, myPos;
let markers = [];

// ì§€ë„ ì´ˆê¸°í™” í•¨ìˆ˜
function initMap() {
    const container = document.getElementById('map');
    navigator.geolocation.getCurrentPosition(pos => {
        myPos = new kakao.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
        const options = { center: myPos, level: 7 };
        map = new kakao.maps.Map(container, options);
        ps = new kakao.maps.services.Places();
        
        // ë‚´ ìœ„ì¹˜ ë§ˆì»¤
        new kakao.maps.Marker({
            position: myPos, 
            map: map,
            image: new kakao.maps.MarkerImage('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png', new kakao.maps.Size(24, 35))
        });
    }, () => {
        // GPS ì‹¤íŒ¨ ì‹œ ì°½ì› ì¤‘ì‹¬
        myPos = new kakao.maps.LatLng(35.247, 128.651);
        map = new kakao.maps.Map(container, { center: myPos, level: 7 });
        ps = new kakao.maps.services.Places();
    });
}

// API ë¡œë“œ í›„ ì‹¤í–‰
kakao.maps.load(initMap);

function searchHubs() {
    if(!ps) return alert("ì§€ë„ê°€ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤.");
    const radius = document.getElementById('radius').value;
    const keywords = ['ê¸°ì°¨ì—­', 'ë²„ìŠ¤í„°ë¯¸ë„'];
    const exclude = ['í™”ë¬¼', 'íì—­', 'ë¬¼ë¥˜', 'ê²€ìˆ˜'];
    
    document.getElementById('resultList').innerHTML = "";
    markers.forEach(m => m.setMap(null)); markers = [];

    keywords.forEach(kw => {
        ps.keywordSearch(kw, (data, status) => {
            if (status === kakao.maps.services.Status.OK) {
                const filtered = data.filter(p => !exclude.some(word => p.place_name.includes(word)));
                filtered.forEach(p => {
                    const isTrain = p.place_name.endsWith('ì—­');
                    const resLink = isTrain ? "https://www.letskorail.com/" : "https://txbus.t-money.co.kr/";
                    
                    // ë§ˆì»¤ í‘œì‹œ
                    const marker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(p.y, p.x), map: map });
                    markers.push(marker);

                    document.getElementById('resultList').innerHTML += `
                        <div class="result-card">
                            <h4>${p.place_name}</h4>
                            <p>${p.address_name} (ì•½ ${p.distance}m)</p>
                            <div class="btn-group">
                                <a href="https://map.kakao.com/link/to/${p.id}" target="_blank" class="action-btn btn-sch">ğŸ“… ì‹œê°„í‘œ</a>
                                <a href="${resLink}" target="_blank" class="action-btn btn-res">ğŸ« ì˜ˆë§¤</a>
                            </div>
                        </div>`;
                });
            }
        }, { location: myPos, radius: radius, sort: kakao.maps.services.SortBy.DISTANCE });
    });
}
</script>
</body>
</html>
