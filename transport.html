<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìŠ¤ë§ˆíŠ¸ êµí†µ í—ˆë¸Œ í¬í„¸</title>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=c4efd9618689d77a19905c8996d3fe3f&libraries=services"></script>
<style>
    :root { --primary: #00d2ff; --sub: #007bff; --accent: #ff9f43; --green: #2ecc71; }
    body { font-family: 'Pretendard', sans-serif; padding: 0; margin: 0; background: #f4f7f6; color: #333; }
    .header-nav { background: #fff; padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #ddd; position: sticky; top:0; z-index:100; }
    .header-nav a { text-decoration: none; color: var(--sub); font-weight: bold; border: 1px solid var(--sub); padding: 4px 10px; border-radius: 5px; }
    .map-container { width: 100%; height: 300px; position: relative; border-bottom: 2px solid var(--primary); }
    #map { width: 100%; height: 100%; }
    .controls { padding: 20px; background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; margin-bottom: 10px; }
    button.search-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
    
    #resultList { padding: 15px; }
    .result-card { background: white; padding: 18px; border-radius: 15px; margin-bottom: 12px; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
    .tag { display: inline-block; padding: 3px 8px; border-radius: 5px; font-size: 0.7rem; font-weight: bold; margin-bottom: 5px; color: white; }
    .tag-train { background: #333; }
    .tag-bus { background: var(--accent); }
    
    .info h4 { margin: 5px 0; color: #222; font-size: 1.1rem; }
    .info p { margin: 2px 0; font-size: 0.85rem; color: #777; }
    
    /* ë²„íŠ¼ ê·¸ë£¹ ë ˆì´ì•„ì›ƒ ìˆ˜ì • */
    .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px; }
    .action-btn { text-align: center; padding: 10px; border-radius: 8px; font-size: 0.8rem; font-weight: bold; text-decoration: none; border: 1px solid #ddd; transition: 0.2s; }
    .btn-schedule { background: #fff4e6; color: #d35400; border-color: #ffd8a8; } /* ì‹œê°„í‘œ */
    .btn-reserve { background: #eafaf1; color: #27ae60; border-color: #abebc6; }  /* ì˜ˆë§¤ */
    .btn-full { grid-column: span 2; background: #f8f9fa; color: #666; font-size: 0.75rem; } /* ìƒì„¸ì •ë³´ */
</style>
</head>
<body>
    <div class="header-nav">
        <a href="index.html">ğŸ  í¬í„¸ë¡œ</a> 
        <span style="margin-left:15px; font-weight:bold;">êµí†µ í—ˆë¸Œ ì‹¤ì‹œê°„ ì •ë³´</span>
    </div>
    
    <div id="map" class="map-container"></div>

    <div class="controls">
        <select id="radius">
            <option value="5000">5km ì´ë‚´</option>
            <option value="10000" selected>10km ì´ë‚´</option>
            <option value="20000">20km ì´ë‚´</option>
        </select>
        <button class="search-btn" onclick="searchHubs()">ë‚´ ì£¼ë³€ ê¸°ì°¨ì—­/í„°ë¯¸ë„ ê²€ìƒ‰</button>
    </div>

    <div id="resultList"></div>

<script>
let map, ps, myPos;
let markers = [];

function initMap() {
    navigator.geolocation.getCurrentPosition(pos => {
        myPos = new kakao.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
        map = new kakao.maps.Map(document.getElementById('map'), { center: myPos, level: 7 });
        ps = new kakao.maps.services.Places();
        
        new kakao.maps.Marker({
            position: myPos, map: map,
            image: new kakao.maps.MarkerImage('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png', new kakao.maps.Size(24, 35))
        });
    });
}

kakao.maps.load(initMap);

function searchHubs() {
    const radius = document.getElementById('radius').value;
    const keywords = ['ê¸°ì°¨ì—­', 'ë²„ìŠ¤í„°ë¯¸ë„'];
    const exclude = ['í™”ë¬¼', 'íì—­', 'ë¬¼ë¥˜', 'ê²€ìˆ˜', 'ê¸°ì§€'];
    
    document.getElementById('resultList').innerHTML = "";
    markers.forEach(m => m.setMap(null)); markers = [];

    keywords.forEach(kw => {
        ps.keywordSearch(kw, (data, status) => {
            if (status === kakao.maps.services.Status.OK) {
                const filtered = data.filter(p => !exclude.some(word => p.place_name.includes(word)));
                displayPlaces(filtered);
            }
        }, { location: myPos, radius: radius, sort: kakao.maps.services.SortBy.DISTANCE });
    });
}

function displayPlaces(places) {
    const list = document.getElementById('resultList');
    places.forEach(p => {
        const isTrain = p.place_name.endsWith('ì—­');
        const typeTag = isTrain ? '<span class="tag tag-train">ê¸°ì°¨/KTX</span>' : '<span class="tag tag-bus">ê³ ì†/ì‹œì™¸ë²„ìŠ¤</span>';
        
        // 1. ì‹¤ì‹œê°„ ì‹œê°„í‘œ í˜ì´ì§€ (ì¹´ì¹´ì˜¤ë§µì˜ ëŒ€ì¤‘êµí†µ íƒ­ í™œìš© - ê°€ì¥ ì •í™•)
        const scheduleLink = `https://map.kakao.com/link/to/${p.id}`; 
        
        // 2. ê³µì‹ ì˜ˆë§¤ í˜ì´ì§€ ë¶„ê¸°
        let reserveLink = isTrain 
            ? `https://www.letskorail.com/ebizprd/EbizPrdTicketpr21111_i1.do` 
            : `https://txbus.t-money.co.kr/main.do`;

        // ì°½ì› í„°ë¯¸ë„ ì˜ˆì™¸ ì²˜ë¦¬
        if(p.place_name.includes("ì°½ì›ì¢…í•©ë²„ìŠ¤í„°ë¯¸ë„")) reserveLink = "https://intercitybus.tmoney.co.kr/";

        const marker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(p.y, p.x), map: map });
        markers.push(marker);

        list.innerHTML += `
            <div class="result-card">
                <div class="info">
                    ${typeTag}
                    <h4>${p.place_name}</h4>
                    <p>${p.road_address_name || p.address_name}</p>
                    <p style="color:var(--sub); font-weight:bold;">ğŸ“ ê±°ë¦¬: ì•½ ${p.distance}m</p>
                </div>
                <div class="btn-group">
                    <a href="${scheduleLink}" target="_blank" class="action-btn btn-schedule">ğŸ“… ì‹¤ì‹œê°„ ì‹œê°„í‘œ</a>
                    <a href="${reserveLink}" target="_blank" class="action-btn btn-reserve">ğŸ« ì¦‰ì‹œ ì˜ˆë§¤</a>
                    <a href="${p.place_url}" target="_blank" class="action-btn btn-full">ìƒì„¸ì •ë³´ ë³´ê¸°</a>
                </div>
            </div>`;
    });
}
</script>
</body>
</html>
