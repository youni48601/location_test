<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìŠ¤ë§ˆíŠ¸ êµí†µ í—ˆë¸Œ í¬í„¸</title>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=c4efd9618689d77a19905c8996d3fe3f&libraries=services"></script>
<style>
    :root { --primary: #00d2ff; --sub: #007bff; --accent: #ff9f43; }
    body { font-family: 'Pretendard', sans-serif; padding: 0; margin: 0; background: #f4f7f6; color: #333; }
    .header-nav { background: #fff; padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #ddd; position: sticky; top:0; z-index:100; }
    .header-nav a { text-decoration: none; color: var(--sub); font-weight: bold; }
    .map-container { width: 100%; height: 300px; border-bottom: 2px solid var(--primary); }
    #map { width: 100%; height: 100%; }
    .controls { padding: 20px; background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; margin-bottom: 10px; }
    button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
    #resultList { padding: 15px; }
    .result-card { background: white; padding: 18px; border-radius: 15px; margin-bottom: 12px; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
    .tag { display: inline-block; padding: 3px 8px; border-radius: 5px; font-size: 0.7rem; font-weight: bold; margin-bottom: 5px; color: white; }
    .tag-train { background: #333; }
    .tag-bus { background: var(--accent); }
    .info h4 { margin: 5px 0; color: #222; font-size: 1.1rem; }
    .info p { margin: 2px 0; font-size: 0.85rem; color: #777; }
    .btn-group { display: flex; gap: 8px; margin-top: 12px; }
    .action-btn { flex: 1; text-align: center; padding: 10px; border-radius: 8px; font-size: 0.85rem; font-weight: bold; text-decoration: none; border: 1px solid #ddd; transition: 0.2s; }
    .btn-time { background: #eef9ff; color: var(--sub); border-color: #b3e5ff; }
    .btn-map { background: #fff; color: #666; }
</style>
</head>
<body>
    <div class="header-nav"><a href="index.html">â† í¬í„¸</a> <span style="margin-left:15px; font-weight:bold;">ìŠ¤ë§ˆíŠ¸ êµí†µ í—ˆë¸Œ ê²€ìƒ‰</span></div>
    
    <div id="map" class="map-container"></div>

    <div class="controls">
        <select id="radius">
            <option value="5000">5km ì´ë‚´</option>
            <option value="10000" selected>10km ì´ë‚´</option>
            <option value="20000">20km ì´ë‚´</option>
            <option value="30000">30km ì´ë‚´ (ê´‘ì—­)</option>
        </select>
        <button onclick="searchHubs()">ì£¼ë³€ êµí†µìˆ˜ë‹¨ ì°¾ê¸°</button>
    </div>

    <div id="resultList"></div>

<script>
let map, ps, myPos;
let markers = [];

kakao.maps.load(() => {
    navigator.geolocation.getCurrentPosition(pos => {
        myPos = new kakao.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
        map = new kakao.maps.Map(document.getElementById('map'), { center: myPos, level: 6 });
        ps = new kakao.maps.services.Places();
        
        new kakao.maps.Marker({
            position: myPos, map: map,
            image: new kakao.maps.MarkerImage('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png', new kakao.maps.Size(24, 35))
        });
    });
});

function searchHubs() {
    const radius = document.getElementById('radius').value;
    const keywords = ['ê¸°ì°¨ì—­', 'ë²„ìŠ¤í„°ë¯¸ë„'];
    const exclude = ['í™”ë¬¼', 'íì—­', 'ë¬¼ë¥˜', 'ê²€ìˆ˜', 'ê¸°ì§€'];
    
    document.getElementById('resultList').innerHTML = "";
    markers.forEach(m => m.setMap(null));
    markers = [];

    keywords.forEach(kw => {
        ps.keywordSearch(kw, (data, status) => {
            if (status === kakao.maps.services.Status.OK) {
                const filtered = data.filter(p => !exclude.some(word => p.place_name.includes(word)));
                displayPlaces(filtered);
            }
        }, { location: myPos, radius: radius, sort: kakao.maps.services.SortBy.DISTANCE });
    });
}

function displayPlaces(places) {
    const list = document.getElementById('resultList');
    places.forEach(p => {
        const isTrain = p.place_name.endsWith('ì—­');
        const typeTag = isTrain ? '<span class="tag tag-train">ê¸°ì°¨/KTX</span>' : '<span class="tag tag-bus">ê³ ì†/ì‹œì™¸ë²„ìŠ¤</span>';
        
        // ì‹œê°„í‘œ ë§í¬ ë¶„ê¸° ì²˜ë¦¬
        // 1. ê¸°ì°¨ì—­ -> ë ˆì¸ ì½”ë ˆì¼ ê²€ìƒ‰ ê²°ê³¼ë¡œ ìœ ë„ (ì´ë¦„ ê¸°ë°˜)
        // 2. í„°ë¯¸ë„ -> í‹°ë¨¸ë‹ˆ ì‹œì™¸ë²„ìŠ¤ í†µí•©ì˜ˆë§¤ ì‚¬ì´íŠ¸ í™œìš©
        let timeLink = isTrain 
            ? `https://www.letskorail.com/ebizprd/EbizPrdTicketpr21111_i1.do` // ì½”ë ˆì¼ ì˜ˆë§¤í˜ì´ì§€
            : `https://txbus.t-money.co.kr/main.do`; // í‹°ë¨¸ë‹ˆ ì‹œì™¸ë²„ìŠ¤

        // ì°½ì›ì¢…í•©ë²„ìŠ¤í„°ë¯¸ë„ ê°™ì€ ê²½ìš°, íŠ¹ì • ê³µì‹ ì‚¬ì´íŠ¸ê°€ ìˆë‹¤ë©´ êµ¬ê¸€ ê²€ìƒ‰ ê²°ê³¼ë¡œ ì—°ê²°í•˜ëŠ”ê²Œ ê°€ì¥ ì •í™•í•¨
        if(p.place_name.includes("ì°½ì›ì¢…í•©ë²„ìŠ¤í„°ë¯¸ë„")) {
            timeLink = "https://intercitybus.tmoney.co.kr/"; 
        }

        const marker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(p.y, p.x), map: map });
        markers.push(marker);

        list.innerHTML += `
            <div class="result-card">
                <div class="info">
                    ${typeTag}
                    <h4>${p.place_name}</h4>
                    <p>${p.road_address_name || p.address_name}</p>
                    <p style="color:var(--sub); font-weight:bold;">ğŸ“ ë‚´ ìœ„ì¹˜ì—ì„œ ì•½ ${p.distance}m</p>
                </div>
                <div class="btn-group">
                    <a href="${timeLink}" target="_blank" class="action-btn btn-time">ì‹¤ì‹œê°„ ì‹œê°„í‘œ/ì˜ˆë§¤</a>
                    <a href="${p.place_url}" target="_blank" class="action-btn btn-map">ìœ„ì¹˜ë³´ê¸°</a>
                </div>
            </div>`;
    });
}
</script>
</body>
</html>