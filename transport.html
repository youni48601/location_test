<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìŠ¤ë§ˆíŠ¸ êµí†µ í—ˆë¸Œ í¬í„¸</title>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=c4efd9618689d77a19905c8996d3fe3f&libraries=services"></script>
<style>
    :root { --primary: #00d2ff; --sub: #007bff; --accent: #ff9f43; }
    body { font-family: 'Pretendard', sans-serif; padding: 0; margin: 0; background: #f4f7f6; color: #333; }
    .header-nav { background: #fff; padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #ddd; position: sticky; top:0; z-index:100; }
    .header-nav a { text-decoration: none; color: var(--sub); font-weight: bold; border: 1px solid var(--sub); padding: 4px 10px; border-radius: 5px; }
    .map-container { width: 100%; height: 350px; position: relative; border-bottom: 2px solid var(--primary); }
    #map { width: 100%; height: 100%; }
    .controls { padding: 20px; background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; margin-bottom: 10px; }
    button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
    #resultList { padding: 15px; }
    .result-card { background: white; padding: 18px; border-radius: 15px; margin-bottom: 12px; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
    .tag { display: inline-block; padding: 3px 8px; border-radius: 5px; font-size: 0.7rem; font-weight: bold; margin-bottom: 5px; color: white; }
    .tag-train { background: #333; }
    .tag-bus { background: var(--accent); }
    .info h4 { margin: 5px 0; color: #222; font-size: 1.1rem; }
    .info p { margin: 2px 0; font-size: 0.85rem; color: #777; }
    .btn-group { display: flex; gap: 8px; margin-top: 12px; }
    .action-btn { flex: 1; text-align: center; padding: 10px; border-radius: 8px; font-size: 0.85rem; font-weight: bold; text-decoration: none; border: 1px solid #ddd; }
    .btn-time { background: #eef9ff; color: var(--sub); border-color: #b3e5ff; }
</style>
</head>
<body>
    <div class="header-nav">
        <a href="index.html">ğŸ  í¬í„¸ë¡œ</a> 
        <span style="margin-left:15px; font-weight:bold;">ìŠ¤ë§ˆíŠ¸ êµí†µ í—ˆë¸Œ ê²€ìƒ‰</span>
    </div>
    
    <div class="map-container">
        <div id="map"></div>
    </div>

    <div class="controls">
        <select id="radius">
            <option value="5000">5km ì´ë‚´</option>
            <option value="10000" selected>10km ì´ë‚´</option>
            <option value="20000">20km ì´ë‚´</option>
            <option value="30000">30km ì´ë‚´</option>
        </select>
        <button onclick="searchHubs()">ë‚´ ì£¼ë³€ ê¸°ì°¨ì—­/í„°ë¯¸ë„ ê²€ìƒ‰</button>
    </div>

    <div id="resultList"></div>

<script>
let map, ps, myPos;
let markers = [];

// [í•µì‹¬ìˆ˜ì •] ì§€ë„ë¥¼ ìƒì„±í•˜ê³  í™”ë©´ì— í‘œì‹œí•˜ëŠ” ë©”ì¸ í•¨ìˆ˜
function initMap() {
    navigator.geolocation.getCurrentPosition(pos => {
        myPos = new kakao.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
        
        const container = document.getElementById('map');
        const options = { center: myPos, level: 7 };
        
        // ì§€ë„ ê°ì²´ ìƒì„±
        map = new kakao.maps.Map(container, options);
        ps = new kakao.maps.services.Places();
        
        // ë‚´ ìœ„ì¹˜ ë§ˆì»¤ í‘œì‹œ
        new kakao.maps.Marker({
            position: myPos, 
            map: map,
            image: new kakao.maps.MarkerImage('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png', new kakao.maps.Size(24, 35))
        });
    }, err => {
        alert("GPS ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
        // GPS ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ìœ„ì¹˜ (ì˜ì°½êµ¬ì²­ ì¸ê·¼)
        myPos = new kakao.maps.LatLng(35.247, 128.651);
        map = new kakao.maps.Map(document.getElementById('map'), { center: myPos, level: 7 });
        ps = new kakao.maps.services.Places();
    });
}

// ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ í›„ ì‹¤í–‰
kakao.maps.load(initMap);

function searchHubs() {
    if(!ps) return alert("ì§€ë„ê°€ ë¡œë“œë˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.");
    
    const radius = document.getElementById('radius').value;
    const keywords = ['ê¸°ì°¨ì—­', 'ë²„ìŠ¤í„°ë¯¸ë„'];
    const exclude = ['í™”ë¬¼', 'íì—­', 'ë¬¼ë¥˜', 'ê²€ìˆ˜', 'ê¸°ì§€'];
    
    document.getElementById('resultList').innerHTML = "";
    markers.forEach(m => m.setMap(null));
    markers = [];

    keywords.forEach(kw => {
        ps.keywordSearch(kw, (data, status) => {
            if (status === kakao.maps.services.Status.OK) {
                const filtered = data.filter(p => !exclude.some(word => p.place_name.includes(word)));
                displayPlaces(filtered);
            }
        }, { location: myPos, radius: radius, sort: kakao.maps.services.SortBy.DISTANCE });
    });
}

function displayPlaces(places) {
    const list = document.getElementById('resultList');
    places.forEach(p => {
        const isTrain = p.place_name.endsWith('ì—­');
        const typeTag = isTrain ? '<span class="tag tag-train">ê¸°ì°¨/KTX</span>' : '<span class="tag tag-bus">ê³ ì†/ì‹œì™¸ë²„ìŠ¤</span>';
        
        // í„°ë¯¸ë„ê³¼ ì—­ì— ë”°ë¥¸ ë§í¬ ìµœì í™”
        let timeLink = isTrain 
            ? `https://www.letskorail.com/` 
            : `https://txbus.t-money.co.kr/`;

        if(p.place_name.includes("ì°½ì›ì¢…í•©ë²„ìŠ¤í„°ë¯¸ë„")) {
            timeLink = "https://intercitybus.tmoney.co.kr/"; 
        }

        // ë§ˆì»¤ ì°ê¸°
        const marker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(p.y, p.x), map: map });
        markers.push(marker);

        list.innerHTML += `
            <div class="result-card">
                <div class="info">
                    ${typeTag}
                    <h4>${p.place_name}</h4>
                    <p>${p.road_address_name || p.address_name}</p>
                    <p style="color:var(--sub); font-weight:bold;">ğŸ“ ì•½ ${p.distance}m</p>
                </div>
                <div class="btn-group">
                    <a href="${timeLink}" target="_blank" class="action-btn btn-time">ì‹¤ì‹œê°„ ì‹œê°„í‘œ/ì˜ˆë§¤</a>
                    <a href="${p.place_url}" target="_blank" class="action-btn btn-map">ì¹´ì¹´ì˜¤ ìƒì„¸ì •ë³´</a>
                </div>
            </div>`;
    });
}
</script>
</body>
</html>
